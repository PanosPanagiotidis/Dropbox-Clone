Α.Μ 1115201500200
Παναγιωτίδης Παναγιώτης.


Παίρνω τα ορίσματα που δίνονται από την γραμμή εντολών.Ελέγχω αν έχει δωθεί σωστός αριθμός από arguments και αν οι φάκελοι που πρέπει να προυπάρχουν υπάρχουν.Αν δεν υπάρχουν κάνω exit.

Δημιουργώ έναν φάκελο logs όπου γράφονται όλα τα logs.

Γράφω το process id στο common_dir με όνομα αρχείου $(id).id.

Έπειτα μπαίνω σε έναν ατέρμων βρόγχο που τον κρατάει η global μεταβλητή keepalive που της έχει δωθεί τιμή 1.

Το mirror_client process κάνει sleep() για 2 δεύτερα και έπειτα :
Ελέγχει αν υπάρχουν νέα αρχεία στο common_dir και τα βάζει στο existing_ids,πίνακας που κρατάει τα ids που έχουν περάσει από την εφαρμογή.

Διαγράφει τα τοπικά mirror folders των clients που έχουν φύγει.

Αν δεν βρεί νέα ids προχωράει σε επόμενη επανάληψη.

Διαφορετικά για κάθε νέο id που έχει βρει:
Δημιουργεί 2 παιδιά,ένα sender και ένα receiver που αναλαμβάνουν να στείλουν και να διαβάσουν αρχεία αντιστοίχα από το κάθε id μέσω named pipes.

O sender :
Διαβάζει το input_directory που του έχει περαστεί από το parent process.
Αν είναι φάκελος το αρχείο που διαβάζει πηγαίνει στον υποφάκελο.

Αν είναι αρχείο,στέλνει το αρχειο μέσω pipe.

Σε περίπτωση επιτυχίας τερματίζει επιτυχώς αλλιώς στέλνει SIGUSR1 στον πατέρα,δηλαδή απέτυχε.

O receiver: 
Διαβάζει συνεχώς μέχρι να λάβει filenamesize = 0
Διαβάζει το όνομα του αρχείου δημιουργεί τα subdirectories και τελικά το ίδιο το αρχείο.
Στέλνει SIGUSR2 σε περίπτωση επιτυχίας αλλιώς στέλνει SIGURS1

Ο πατέρας άμα λάβει  SIGURS1:
Ελέγχει ποιό παιδί το έστειλε μέσω του pid του που είναι αποθηκευμένο σε έναν global πίνακα.
Αν το συγκεκριμένο παιδί έχει προσπαθήσει > 3 φορές δεν προσπαθεί ξανά.
Διαφορετικά κάνει fork άλλο παιδί ανάλογα αν είναι s(ender) ή r(eceiver) με τα ίδια στοιχεία.

Ο ατέρμων βρόγχος τελειώνει μόνο αν το mirror_client δεχθεί SIGINT ή SIGQUIT.
Στις 2 αυτές περιπτώσεις θέτει το keepalive = 0.
Σταματάει η λούπα διαγράφεται το id αρχείο του client από το common_dir και το mirror_dir του
γράφει στο log αρχείο οτι τελείωσε,αποδεσμεύει την μνήμη και κάνει exit.


To create_infiles.sh script δημιουργεί έναν αριθμό από files & directories στο directory που του ορίζουμε

